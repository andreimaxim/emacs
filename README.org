#+TITLE: Emacs Configuration
#+AUTHOR: Andrei Maxim
#+PROPERTY: header-args :tangle yes


** Setup

Install required system packages:

#+begin_src shell
  sudo apt install build-essential libgtk-3-dev libgnutls28-dev libtiff5-dev libgif-dev \
       libjpeg-dev libpng-dev libxpm-dev libncurses-dev texinfo autoconf libjansson4 \
       libjansson-dev libgccjit0 libgccjit-10-dev gcc-10 g++-10
#+end_src

Setup the default compiler to point to gcc-10:

#+begin_src shell
  export CC=/usr/bin/gcc-10 CXX=/usr/bin/gcc-10
#+end_src

Clone the Emacs repository:

#+begin_src shell
  git clone git://git.sv.gnu.org/emacs.git
#+end_src

#+begin_src shell
  cd emacs
#+end_src

Check out the branch for v29, if it's not already checked out:

#+begin_src shell
  git checkout -b emacs-29
#+end_src

If the directory is already cloned, reset its state:

#+begin_src shell
  git clean -fdx
#+end_src

Configure Emacs with the required features:

#+begin_src shell
  ./autogen.sh
#+end_src

#+begin_src shell
  ./configure --with-native-compilation --with-json --with-rsvg --with-xml2
#+end_src

#+begin_src shell
  make --jobs=$(nproc)
#+end_src

#+begin_src shell
  sudo make install
#+end_src

** Packages

*** Ripgrep

#+begin_src shell
  sudo apt install ripgrep
#+end_src

*** pgFormatter

Install required Perl packages on Ubuntu 22.04:

#+begin_src shell
  sudo apt install perl-doc
#+end_src

Install the package locally:

#+begin_src shell
  git clone git@github.com:darold/pgFormatter.git
#+end_src

#+begin_src shell
  cd pgFormatter
#+end_src

#+begin_src shell
  git checkout v5.5
#+end_src

#+begin_src shell
  perl Makefile.PL
#+end_src

#+begin_src shell
  make
#+end_src

#+begin_src shell
  sudo make install
#+end_src


** Project-specific setup

Add this to a =dir-locals.el= file in the project root to have =devdocs=
automatically search through Ruby 3.1 and Ruby on Rails 7.0 documentation:

#+begin_src emacs-lisp
  ((ruby-mode . ((eval . (setq-local devdocs-current-docs '("ruby~3.1" "rails~7.0"))))))
#+end_src
